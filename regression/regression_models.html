

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Application: Bandgap Prediction &#8212; Materials + Machine Learning</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-MBS9YS5YW0"></script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-MBS9YS5YW0');
            </script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'regression/regression_models';</script>
    <link rel="shortcut icon" href="../_static/logo_small.png"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Unsupervised Learning" href="../unsupervised_learning/unsupervised_learning.html" />
    <link rel="prev" title="Kernel Machines" href="kernel_machines.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo.svg" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="../_static/logo.svg" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../index.html">
                    Materials + ML Workshop
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../intro/intro.html">Introduction</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../intro/jupyter.html">Installing Python and Jupyter Notebook</a></li>
<li class="toctree-l2"><a class="reference internal" href="../intro/colab.html">Using Google Colab</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../python/getting_started.html">Getting Started with Python</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../python/python_basics.html">Python Basics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../python/python_logic.html">Logic and Flow Control</a></li>
<li class="toctree-l2"><a class="reference internal" href="../python/loops.html">Loops</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../data_types/python_data_types.html">Python Data Types</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-3"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../data_types/sets_and_dicts.html">Sets and Dictionaries</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../functions/functions_classes.html">Python Functions and Classes</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-4"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../functions/classes.html">Classes and Object-Oriented Programming</a></li>




</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../scicomp/numpy_scipy.html">Scientific Computing with Numpy and Scipy</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-5"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../scicomp/numpy.html">The Numpy Package</a></li>
<li class="toctree-l2"><a class="reference internal" href="../scicomp/scipy.html">The Scipy Package</a></li>



</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../data_vis/data_handling.html">Data Handling and Visualization</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-6"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../data_vis/data_vis.html">Data Visualization with Matplotlib</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../matsci/matsci_packages.html">Materials Science Python Packages</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-7"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../matsci/ase.html">ASE - The Atomic Simulation Environment</a></li>
<li class="toctree-l2"><a class="reference internal" href="../matsci/pymatgen_MPRester.html">Pymatgen and the Materials Project API</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../ml_intro/ml_intro.html">Introduction to Machine Learning</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-8"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../ml_intro/statistics_review.html">Statistics Review</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ml_intro/math_review.html">Mathematics Review</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../supervised_learning/supervised_learning.html">Supervised Learning</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-9"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../supervised_learning/fitting_models.html">Fitting Supervised Models</a></li>
<li class="toctree-l2"><a class="reference internal" href="../supervised_learning/basic_models.html">Application: Classifying Perovskites</a></li>
</ul>
</li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="regression.html">Advanced Regression Models</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-10"><i class="fa-solid fa-chevron-down"></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="kernel_machines.html">Kernel Machines</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Application: Bandgap Prediction</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../unsupervised_learning/unsupervised_learning.html">Unsupervised Learning</a><input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-11"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../unsupervised_learning/feature_selection.html">Feature Selection and Dimensionality Reduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../unsupervised_learning/clustering.html">Clustering and Distribution Estimation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../unsupervised_learning/unsupervised_applications.html">Application: Classifying Superconductors</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../neural_networks/neural_networks.html">Neural Networks</a><input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-12"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../neural_networks/basics.html">Basic Neural Networks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../neural_networks/training.html">Training Neural Networks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../neural_networks/architectures.html">Neural Network Architectures</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../applications/applications.html">Applications of ML to Materials Science</a><input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-13"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../applications/ALIGNN_Tutorial.html">ALIGNN Tutorial</a></li>
</ul>
</li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/cburdine/materials-ml-workshop" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/cburdine/materials-ml-workshop/issues/new?title=Issue%20on%20page%20%2Fregression/regression_models.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/regression/regression_models.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Application: Bandgap Prediction</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#bandgap-dataset">Bandgap Dataset</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#loading-the-dataset">Loading the Dataset</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#classifying-metals-and-non-metals">Classifying Metals and Non-Metals</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#estimating-the-bandgap-of-non-metals">Estimating the Bandgap of Non-Metals:</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#ridge-regression-model">Ridge Regression Model:</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#gradient-boosting-regression">Gradient Boosting Regression</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#rbf-support-vector-regression">RBF Support Vector Regression</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercises">Exercises</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#solutions">Solutions</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-1-classifying-direct-vs-indirect-bandgaps">Exercise 1: Classifying Direct vs. Indirect Bandgaps</a></li>
</ul>
</li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="application-bandgap-prediction">
<h1>Application: Bandgap Prediction<a class="headerlink" href="#application-bandgap-prediction" title="Permalink to this heading">#</a></h1>
<p>Let’s now try to tackle a more difficult regression problem: predicting material bandgaps. The bandgap of a material is an important property related to whether or not a material is a conductor: Materials with a zero bandgap are typically conductors, whereas materials with a positive bandgap are insulators (if the gap is large) or semiconductors (if the gap is small). We can estimate the bandgap by examining the largest gap between the energies of two states in the material’s <em>band structure</em>. For example, the bandgap of one crystalline phase of the insulator SiO<span class="math notranslate nohighlight">\(_2\)</span> <a class="reference external" href="https://next-gen.materialsproject.org/materials/mp-546794?formula=SiO2">(mp-546794)</a> is roughly 5.69 eV, which is the difference in band energy at the <span class="math notranslate nohighlight">\(\Gamma\)</span> point (shown in purple):</p>
<p><img alt="SiO2 bandgap" src="../_images/SiO2_band.png" /></p>
<section id="bandgap-dataset">
<h2>Bandgap Dataset<a class="headerlink" href="#bandgap-dataset" title="Permalink to this heading">#</a></h2>
<p>The band gap can be estimated through <em>ab initio</em> calculation methods, such as <em>density functional theory</em> (DFT). In this section, we will use band gap values estimated through DFT calculations as reported in the Materials Project Database.</p>
<div class="important dropdown admonition">
<p class="admonition-title">Notes about Bandgap Estimation and DFT</p>
<p>For more information on how bandgaps are estimated in the Materials Project, see the <a class="reference external" href="https://docs.materialsproject.org/methodology/materials-methodology/electronic-structure">Electronic Structure</a> documentation page. Take particular note of the “Computed Gap” versus “Experimental Gap” plot, which reflects a mean absolute error of 0.6 eV:</p>
<p><img alt="bandgap errors" src="../_images/bandgap_errs.png" /></p>
<p>(There are some methods in DFT that can correct for this, such as the <a class="reference external" href="https://pubs.aip.org/aip/jcp/article/110/13/6158/476177/Toward-reliable-density-functional-methods-without">PBE0 model</a> or the <a class="reference external" href="https://journals.aps.org/pr/abstract/10.1103/PhysRev.139.A796">GW approach</a>, but neither of these appear to be used in the Materials Project).</p>
<p>In short, this means that we must be very careful if we want to apply our models from this section to make predictions of real bandgaps measured through experiment, especially insulators with large bandgaps.</p>
</div>
<p>You can download the dataset for this section using the following Python code:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">requests</span>

<span class="n">CSV_URL</span> <span class="o">=</span> <span class="s1">&#39;https://raw.githubusercontent.com/cburdine/materials-ml-workshop/main/MaterialsML/regression/bandgaps.csv&#39;</span>

<span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">CSV_URL</span><span class="p">)</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;bandgaps.csv&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</pre></div>
</div>
<p>Alternatively, you can download the CSV file directly <a class="reference external" href="https://raw.githubusercontent.com/cburdine/materials-ml-workshop/main/MaterialsML/regression/bandgaps.csv">here</a>.</p>
</section>
<section id="loading-the-dataset">
<h2>Loading the Dataset<a class="headerlink" href="#loading-the-dataset" title="Permalink to this heading">#</a></h2>
<p>To start, let’s load the dataset into a Pandas dataframe and view it:</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="c1"># load dataset into a pandas DataFrame:</span>
<span class="n">BANDGAP_CSV</span> <span class="o">=</span> <span class="s1">&#39;bandgaps.csv&#39;</span>
<span class="n">data_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">BANDGAP_CSV</span><span class="p">)</span>

<span class="c1"># show dataframe in notebook:</span>
<span class="n">display</span><span class="p">(</span><span class="n">data_df</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>mp_id</th>
      <th>formula</th>
      <th>composition</th>
      <th>crystal_system</th>
      <th>symmetry_symbol</th>
      <th>volume</th>
      <th>density</th>
      <th>e_fermi</th>
      <th>formation_energy_per_atom</th>
      <th>band_gap</th>
      <th>bandgap_direct</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>mp-1005</td>
      <td>FeP</td>
      <td>{'Fe': 1, 'P': 1}</td>
      <td>Orthorhombic</td>
      <td>Pnma</td>
      <td>90.583862</td>
      <td>6.366076</td>
      <td>9.163143</td>
      <td>-0.598423</td>
      <td>0.0000</td>
      <td>False</td>
    </tr>
    <tr>
      <th>1</th>
      <td>mp-1006367</td>
      <td>Ce2HfSe5</td>
      <td>{'Ce': 2, 'Hf': 1, 'Se': 5}</td>
      <td>Orthorhombic</td>
      <td>Pnma</td>
      <td>785.754385</td>
      <td>7.215011</td>
      <td>6.181067</td>
      <td>-1.941463</td>
      <td>0.0000</td>
      <td>False</td>
    </tr>
    <tr>
      <th>2</th>
      <td>mp-1001606</td>
      <td>LuFeC2</td>
      <td>{'Lu': 1, 'Fe': 1, 'C': 2}</td>
      <td>Orthorhombic</td>
      <td>Amm2</td>
      <td>45.919844</td>
      <td>9.215206</td>
      <td>5.530327</td>
      <td>-0.286076</td>
      <td>0.0000</td>
      <td>False</td>
    </tr>
    <tr>
      <th>3</th>
      <td>mp-1001613</td>
      <td>LuGa</td>
      <td>{'Lu': 1, 'Ga': 1}</td>
      <td>Orthorhombic</td>
      <td>Cmcm</td>
      <td>87.819318</td>
      <td>9.253483</td>
      <td>3.090952</td>
      <td>-0.608621</td>
      <td>0.0000</td>
      <td>False</td>
    </tr>
    <tr>
      <th>4</th>
      <td>mp-1008624</td>
      <td>YBiPd</td>
      <td>{'Y': 1, 'Bi': 1, 'Pd': 1}</td>
      <td>Cubic</td>
      <td>F-43m</td>
      <td>74.987877</td>
      <td>8.952998</td>
      <td>5.397804</td>
      <td>-0.961384</td>
      <td>0.0000</td>
      <td>False</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>29190</th>
      <td>mp-555534</td>
      <td>K4MnMo4O15</td>
      <td>{'K': 4, 'Mn': 1, 'Mo': 4, 'O': 15}</td>
      <td>Trigonal</td>
      <td>P-3</td>
      <td>808.366683</td>
      <td>3.430836</td>
      <td>0.147938</td>
      <td>-2.154358</td>
      <td>2.9808</td>
      <td>False</td>
    </tr>
    <tr>
      <th>29191</th>
      <td>mp-23703</td>
      <td>LiH</td>
      <td>{'Li': 1, 'H': 1}</td>
      <td>Cubic</td>
      <td>Fm-3m</td>
      <td>16.207758</td>
      <td>0.814396</td>
      <td>-0.997677</td>
      <td>-0.495530</td>
      <td>2.9810</td>
      <td>True</td>
    </tr>
    <tr>
      <th>29192</th>
      <td>mp-561093</td>
      <td>Rb2Cr2O7</td>
      <td>{'Rb': 2, 'Cr': 2, 'O': 7}</td>
      <td>Monoclinic</td>
      <td>P2_1/c</td>
      <td>793.897416</td>
      <td>3.237203</td>
      <td>-1.868672</td>
      <td>-1.934791</td>
      <td>2.9814</td>
      <td>True</td>
    </tr>
    <tr>
      <th>29193</th>
      <td>mp-16180</td>
      <td>Na6S2O9</td>
      <td>{'Na': 6, 'S': 2, 'O': 9}</td>
      <td>Cubic</td>
      <td>Fm-3m</td>
      <td>218.925628</td>
      <td>2.624871</td>
      <td>1.735700</td>
      <td>-2.095472</td>
      <td>2.9814</td>
      <td>False</td>
    </tr>
    <tr>
      <th>29194</th>
      <td>mp-557108</td>
      <td>Ba2Nb2TeO10</td>
      <td>{'Ba': 2, 'Nb': 2, 'Te': 1, 'O': 10}</td>
      <td>Orthorhombic</td>
      <td>Pbca</td>
      <td>943.682404</td>
      <td>5.265263</td>
      <td>1.411631</td>
      <td>-2.859859</td>
      <td>2.9816</td>
      <td>False</td>
    </tr>
  </tbody>
</table>
<p>29195 rows × 11 columns</p>
</div></div></div>
</div>
<p>There are several different features included in this dataset. Here’s a summary of the included features:</p>
<ul class="simple">
<li><p><em>mp_id</em>: Materials Project ID of material</p></li>
<li><p><em>formula</em>: Chemical formula</p></li>
<li><p><em>composition</em>: Composition of the material in the unit cell (as a Python <code class="docutils literal notranslate"><span class="pre">dict</span></code>)</p></li>
<li><p><em>crystal_system</em>: Crystal system of the material</p></li>
<li><p><em>symetry_symbol</em>: Space group symbol of crystal structure</p></li>
<li><p><em>volume</em>: Unit cell volume (Å<span class="math notranslate nohighlight">\(^3\)</span>)</p></li>
<li><p><em>density</em>: Density of material (g/cm<span class="math notranslate nohighlight">\(^3\)</span>)</p></li>
<li><p><em>e_fermi</em>: Fermi energy (relative to calculated band structure) (eV)</p></li>
<li><p><em>formation_energy_per_atom</em>: Formation energy per unit cell atom (eV/atom)</p></li>
<li><p><em>bandgap</em>: Estimated bandgap of the material (eV)</p></li>
<li><p><em>bandgap_direct</em>: Whether or not the estimated bandgap is direct.</p></li>
</ul>
<p>The most important features that uniquely identify each material in the dataset are the composition and crystal system of each material. If we want to include this as a feature in a supervised model, we must find a way to convert these feature to a numerical vector. Let’s start by listing all of the elements and crystal systems in the dataset:</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Generate a list of elements in the dataset:</span>
<span class="n">ELEMENTS</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
<span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">data_df</span><span class="p">[</span><span class="s1">&#39;composition&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">:</span>
    <span class="n">ELEMENTS</span> <span class="o">|=</span> <span class="nb">set</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
<span class="n">ELEMENTS</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">ELEMENTS</span><span class="p">)</span>

<span class="c1"># Generate a list of the crystal systems in the dataset:</span>
<span class="n">CRYSTAL_SYSTEMS</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">data_df</span><span class="p">[</span><span class="s1">&#39;crystal_system&#39;</span><span class="p">]))</span>

<span class="c1"># print the sizes of ELEMENTS and CRYSTAL_SYSTEMS</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Number of elements:&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">ELEMENTS</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Number of crystal systems:&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">CRYSTAL_SYSTEMS</span><span class="p">))</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Number of elements: 86
Number of crystal systems: 7
</pre></div>
</div>
</div>
</div>
<p>We see that there are 86 elements represented in the dataset and 7 different crystal systems. The simplest way of converging the composition of each material to a vector is by representing it as a “bag of atoms”, that is, by converting the composition to a vector with 86 entries (representing the 86 elements present in the data) where the entry of each vector represents the fraction of the unit cell occupied by the corresponding element.</p>
<p>We can also represent the crystal system of each material as a vector with seven entries, where only the value corresponding to the crystal system is set to 1. The remaining entries of this vector are set to 0. Below, we write Python functions to vectorize the material composition and the crystal system:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="k">def</span> <span class="nf">vectorize_composition</span><span class="p">(</span><span class="n">composition</span><span class="p">,</span> <span class="n">elements</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; converts an elemental composition dict to a vector. &quot;&quot;&quot;</span>
    <span class="n">total_n</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">composition</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
    <span class="n">vec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">elements</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">elem</span><span class="p">,</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">composition</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">elements</span><span class="p">:</span>
            <span class="n">vec</span><span class="p">[</span><span class="n">elements</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">elem</span><span class="p">)]</span> <span class="o">=</span> <span class="n">n</span><span class="o">/</span><span class="n">total_n</span>
    <span class="k">return</span> <span class="n">vec</span>

<span class="k">def</span> <span class="nf">vectorize_crystal_system</span><span class="p">(</span><span class="n">crystal_system</span><span class="p">,</span> <span class="n">systems</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; converts a crystal system to a vector. &quot;&quot;&quot;</span>
    <span class="n">vec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">systems</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">crystal_system</span> <span class="ow">in</span> <span class="n">systems</span><span class="p">:</span>
        <span class="n">vec</span><span class="p">[</span><span class="n">systems</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">crystal_system</span><span class="p">)]</span> <span class="o">=</span> <span class="mf">1.0</span>
        
    <span class="k">return</span> <span class="n">vec</span>
</pre></div>
</div>
</div>
</div>
<p>Below, we give some examples of how this vectorization procedure works for compositions and crystal systems:</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># generate an example of a composition vector:</span>
<span class="n">test_comp</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Si&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;O&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">}</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Example of a composition vector:&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">vectorize_composition</span><span class="p">(</span>
            <span class="n">test_comp</span><span class="p">,</span> 
            <span class="n">elements</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="s1">&#39;O&#39;</span><span class="p">,</span> <span class="s1">&#39;Si&#39;</span><span class="p">]))</span>

<span class="c1"># generate an example of a crystal system vector:</span>
<span class="n">test_system</span> <span class="o">=</span> <span class="s1">&#39;Hexagonal&#39;</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Example of a crystal system vector:&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">vectorize_crystal_system</span><span class="p">(</span>
            <span class="n">test_system</span><span class="p">,</span> 
            <span class="n">systems</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Cubic&#39;</span><span class="p">,</span> <span class="s1">&#39;Hexagonal&#39;</span><span class="p">]))</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Example of a composition vector:
[0.         0.66666667 0.33333333]
Example of a crystal system vector:
[0. 1.]
</pre></div>
</div>
</div>
</div>
<p>Next, let’s write a function that extracts features from each row in the dataframe and constructs each material’s feature vector <span class="math notranslate nohighlight">\(\mathbf{x}\)</span> and label vector <span class="math notranslate nohighlight">\(\mathbf{y}\)</span>. The feature vector <span class="math notranslate nohighlight">\(\mathbf{x}\)</span> will contain the following values combined into a single vector:</p>
<ul class="simple">
<li><p>The material’s “bag of atoms” composition vector</p></li>
<li><p>The material’s crystal system vector</p></li>
<li><p>The material’s unit cell volume</p></li>
<li><p>The material’s density</p></li>
<li><p>The material’s formation energy per atom</p></li>
</ul>
<p>The label vector <span class="math notranslate nohighlight">\(\mathbf{y}\)</span> for each material will contain two values: the band gap of the material (in eV) and a value of <span class="math notranslate nohighlight">\(\pm 1\)</span> indicating if the band gap is direct or indirect.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">parse_data_vector</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; parses x and y vectors from a dataframe row &quot;&quot;&quot;</span>
    
    <span class="c1"># parse whether or not the bandgap is direct: </span>
    <span class="n">bandgap_direct</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;bandgap_direct&#39;</span><span class="p">]</span> <span class="k">else</span> <span class="o">-</span><span class="mf">1.0</span>
    
    <span class="c1"># parse the composition dict:</span>
    <span class="n">composition_dict</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;composition&#39;</span><span class="p">])</span>
    
    <span class="c1"># parse feature vector (x):</span>
    <span class="n">x_vector</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span>
        <span class="n">vectorize_composition</span><span class="p">(</span><span class="n">composition_dict</span><span class="p">,</span> <span class="n">ELEMENTS</span><span class="p">),</span>
        <span class="n">vectorize_crystal_system</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;crystal_system&#39;</span><span class="p">],</span> <span class="n">CRYSTAL_SYSTEMS</span><span class="p">),</span>
        <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;volume&#39;</span><span class="p">]</span> <span class="p">]),</span>
        <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;density&#39;</span><span class="p">]</span> <span class="p">]),</span>
        <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;formation_energy_per_atom&#39;</span><span class="p">]</span> <span class="p">]),</span>
    <span class="p">])</span>
    
    <span class="c1"># parse label vector (y):</span>
    <span class="n">y_vector</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span>
        <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;band_gap&#39;</span><span class="p">]</span> <span class="p">]),</span>
        <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="n">bandgap_direct</span> <span class="p">])</span>
    <span class="p">])</span>
    
    <span class="k">return</span> <span class="n">x_vector</span><span class="p">,</span> <span class="n">y_vector</span>
</pre></div>
</div>
</div>
</div>
<p>Next, we will iterate over each row in the dataframe and apply the <code class="docutils literal notranslate"><span class="pre">parse_data_vector()</span></code> function to extract the <span class="math notranslate nohighlight">\(\mathbf{x}\)</span> and <span class="math notranslate nohighlight">\(\mathbf{y}\)</span> vectors from the dataset. We will take the list of all <span class="math notranslate nohighlight">\(\mathbf{x}\)</span> and <span class="math notranslate nohighlight">\(\mathbf{y}\)</span> vectors and convert them into a pair of numpy arrays:</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># parse x and y vectors from dataframe rows:</span>
<span class="n">data_x</span><span class="p">,</span> <span class="n">data_y</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">data_df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
    <span class="n">x_vector</span><span class="p">,</span> <span class="n">y_vector</span> <span class="o">=</span> <span class="n">parse_data_vector</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
    <span class="n">data_x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x_vector</span><span class="p">)</span>
    <span class="n">data_y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y_vector</span><span class="p">)</span>

<span class="c1"># convert x and y to numpy arrays:</span>
<span class="n">data_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data_x</span><span class="p">)</span>
<span class="n">data_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data_y</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;data_x shape:&#39;</span><span class="p">,</span> <span class="n">data_x</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;data_y shape:&#39;</span><span class="p">,</span> <span class="n">data_y</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>data_x shape: (29195, 96)
data_y shape: (29195, 2)
</pre></div>
</div>
</div>
</div>
<p>Now that we have parsed features from the dataset, let’s write some functions that will automatically split data into training, validation, and test set. We may also find it useful to write a function that normalizes these sets as well:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>

<span class="k">def</span> <span class="nf">train_val_test_split</span><span class="p">(</span><span class="n">data_x</span><span class="p">,</span> <span class="n">data_y</span><span class="p">,</span> <span class="n">split</span><span class="o">=</span><span class="p">(</span><span class="mf">0.8</span><span class="p">,</span><span class="mf">0.1</span><span class="p">,</span><span class="mf">0.1</span><span class="p">)):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; splits data into train, validation, and test sets. &quot;&quot;&quot;</span>
    
    <span class="c1"># split train and nontrain data:</span>
    <span class="n">train_x</span><span class="p">,</span> <span class="n">nontrain_x</span><span class="p">,</span> <span class="n">train_y</span><span class="p">,</span> <span class="n">nontrain_y</span> <span class="o">=</span> \
        <span class="n">train_test_split</span><span class="p">(</span>
            <span class="n">data_x</span><span class="p">,</span> <span class="n">data_y</span><span class="p">,</span> <span class="n">train_size</span><span class="o">=</span><span class="n">split</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="nb">sum</span><span class="p">(</span><span class="n">split</span><span class="p">))</span>
    
    <span class="c1"># split validation and test data:</span>
    <span class="n">val_x</span><span class="p">,</span> <span class="n">test_x</span><span class="p">,</span> <span class="n">val_y</span><span class="p">,</span> <span class="n">test_y</span> <span class="o">=</span> \
        <span class="n">train_test_split</span><span class="p">(</span>
            <span class="n">data_x</span><span class="p">,</span> <span class="n">data_y</span><span class="p">,</span> 
            <span class="n">test_size</span><span class="o">=</span><span class="n">split</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">split</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">split</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
    
    <span class="k">return</span> <span class="p">(</span><span class="n">train_x</span><span class="p">,</span> <span class="n">val_x</span><span class="p">,</span> <span class="n">test_x</span><span class="p">),</span> \
           <span class="p">(</span><span class="n">train_y</span><span class="p">,</span> <span class="n">val_y</span><span class="p">,</span> <span class="n">test_y</span><span class="p">)</span>
    
<span class="k">def</span> <span class="nf">normalize</span><span class="p">(</span><span class="n">train_x</span><span class="p">,</span> <span class="n">val_x</span><span class="p">,</span> <span class="n">test_x</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; normalizes a dataset. &quot;&quot;&quot;</span>
    
    <span class="n">scaler</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span>
    <span class="n">train_z</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">train_x</span><span class="p">)</span>
    <span class="n">val_z</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">val_x</span><span class="p">)</span>
    <span class="n">test_z</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">test_x</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">scaler</span><span class="p">,</span> <span class="n">train_z</span><span class="p">,</span> <span class="n">val_z</span><span class="p">,</span> <span class="n">test_z</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="classifying-metals-and-non-metals">
<h2>Classifying Metals and Non-Metals<a class="headerlink" href="#classifying-metals-and-non-metals" title="Permalink to this heading">#</a></h2>
<p>The first supervised learning problem we will examine is discriminating between materials with a bandgap that is zero (i.e. metals) and materials with a bandgap that is nonzero (i.e. insulators). We will start by creating a vector of <span class="math notranslate nohighlight">\(y\)</span> values with values of <span class="math notranslate nohighlight">\(\pm 1\)</span> indicating whether a material is a metal or nonmetal:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">metals_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="mf">1.0</span> <span class="k">if</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="k">else</span> <span class="o">-</span><span class="mi">1</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">data_y</span><span class="p">])</span>

<span class="n">metal_subsets_x</span><span class="p">,</span> <span class="n">metal_subsets_y</span> <span class="o">=</span> \
    <span class="n">train_val_test_split</span><span class="p">(</span><span class="n">data_x</span><span class="p">,</span> <span class="n">metals_y</span><span class="p">)</span>

<span class="n">train_x</span><span class="p">,</span> <span class="n">val_x</span><span class="p">,</span> <span class="n">test_x</span> <span class="o">=</span> <span class="n">metal_subsets_x</span>
<span class="n">train_y</span><span class="p">,</span> <span class="n">val_y</span><span class="p">,</span> <span class="n">test_y</span> <span class="o">=</span> <span class="n">metal_subsets_y</span>

<span class="n">scaler</span><span class="p">,</span> <span class="n">train_z</span><span class="p">,</span> <span class="n">val_z</span><span class="p">,</span> <span class="n">test_z</span> <span class="o">=</span> \
    <span class="n">normalize</span><span class="p">(</span><span class="n">train_x</span><span class="p">,</span> <span class="n">val_x</span><span class="p">,</span> <span class="n">test_x</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>It’s usually best to start by seeing how well a simple models such as a linear classifier fits the data. We could use a linear classifier (also known as a <em>Perceptron</em>) like we did in the last application section. Since we now know about how regularization can sometimes improve the validation accuracy of a linear model, let’s use a <em>ridge regression linear classifier</em> that is equipped with a regularization parameter <span class="math notranslate nohighlight">\(\lambda\)</span>. When <span class="math notranslate nohighlight">\(\lambda = 0\)</span>, (no regularization is applied) the model is identical to a linear classifier. Scikit-learn provides an implementation of this with <a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.linear_model.RidgeClassifier.html#sklearn.linear_model.RidgeClassifier"><code class="docutils literal notranslate"><span class="pre">sklearn.linear_model.RidgeClassifier</span></code></a>. (Note that in sklearn, the regularization parameter <span class="math notranslate nohighlight">\(\lambda\)</span> is referred to as <span class="math notranslate nohighlight">\(\alpha\)</span>) After fitting the model, we can also use scikit-learn’s ConfusionMatrix class to visualize the kinds of classification errors made by our model on the validation set:</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">RidgeClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">confusion_matrix</span><span class="p">,</span> <span class="n">ConfusionMatrixDisplay</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">RidgeClassifier</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_z</span><span class="p">,</span> <span class="n">train_y</span><span class="p">)</span>

<span class="n">train_yhat</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">train_z</span><span class="p">)</span>
<span class="n">val_yhat</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">val_z</span><span class="p">)</span>

<span class="c1"># compute accuracy:</span>
<span class="n">cm</span> <span class="o">=</span> <span class="n">confusion_matrix</span><span class="p">(</span><span class="n">val_y</span><span class="p">,</span> <span class="n">val_yhat</span><span class="p">)</span>

<span class="c1"># display confusion matrix:</span>
<span class="n">disp</span> <span class="o">=</span> <span class="n">ConfusionMatrixDisplay</span><span class="p">(</span><span class="n">confusion_matrix</span><span class="o">=</span><span class="n">cm</span><span class="p">,</span>
                              <span class="n">display_labels</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">classes_</span><span class="p">)</span>
<span class="n">disp</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">([</span><span class="s1">&#39;Non Metal&#39;</span><span class="p">,</span> <span class="s1">&#39;Metal&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([</span><span class="s1">&#39;Non Metal&#39;</span><span class="p">,</span> <span class="s1">&#39;Metal&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../_images/e094cfdcb306556f3426b6953aecec5d9a62950bfa1dce2132865036e4449604.png" src="../_images/e094cfdcb306556f3426b6953aecec5d9a62950bfa1dce2132865036e4449604.png" />
</div>
</div>
<p>From inspecting the confusion matrix, we see that a significant majority of the materials were classified correctly, with almost three times as many metals being predicted as non-metals than non-metals being predicted as metals. We can evaluate the overall validation set accuracy of the model from the confusion matrix as follows:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">accuracy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">cm</span><span class="p">))</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">cm</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">accuracy</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.8688771665410701
</pre></div>
</div>
</div>
</div>
</section>
<section id="estimating-the-bandgap-of-non-metals">
<h2>Estimating the Bandgap of Non-Metals:<a class="headerlink" href="#estimating-the-bandgap-of-non-metals" title="Permalink to this heading">#</a></h2>
<p>We have shown that we can classify materials as metals or non-metals with accuracy close to 90%. The next problem we will consider is estimating the bandgap of materials that are either known to be non-metals or are classified by the previous model as such. Let’s start by extracting all non-metallic materials with nonzero bandgaps:</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bandgap_x</span> <span class="o">=</span> <span class="n">data_x</span><span class="p">[</span><span class="n">data_y</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
<span class="n">bandgap_y</span> <span class="o">=</span> <span class="n">data_y</span><span class="p">[(</span><span class="n">data_y</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">),</span><span class="mi">0</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;bandgap_x shape:&#39;</span><span class="p">,</span> <span class="n">bandgap_x</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;bandgap_y shape:&#39;</span><span class="p">,</span> <span class="n">bandgap_y</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>bandgap_x shape: (11464, 96)
bandgap_y shape: (11464,)
</pre></div>
</div>
</div>
</div>
<p>We can normalize this data with the following code:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bandgap_subsets_x</span><span class="p">,</span> <span class="n">bandgap_subsets_y</span> <span class="o">=</span> \
    <span class="n">train_val_test_split</span><span class="p">(</span><span class="n">bandgap_x</span><span class="p">,</span> <span class="n">bandgap_y</span><span class="p">)</span>

<span class="n">train_x</span><span class="p">,</span> <span class="n">val_x</span><span class="p">,</span> <span class="n">test_x</span> <span class="o">=</span> <span class="n">bandgap_subsets_x</span>
<span class="n">train_y</span><span class="p">,</span> <span class="n">val_y</span><span class="p">,</span> <span class="n">test_y</span> <span class="o">=</span> <span class="n">bandgap_subsets_y</span>

<span class="n">scaler</span><span class="p">,</span> <span class="n">train_z</span><span class="p">,</span> <span class="n">val_z</span><span class="p">,</span> <span class="n">test_z</span> <span class="o">=</span> \
    <span class="n">normalize</span><span class="p">(</span><span class="n">train_x</span><span class="p">,</span> <span class="n">val_x</span><span class="p">,</span> <span class="n">test_x</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="ridge-regression-model">
<h2>Ridge Regression Model:<a class="headerlink" href="#ridge-regression-model" title="Permalink to this heading">#</a></h2>
<p>Since predicting the bandgap is a regression problem, a good model to start with is ridge regression. We will use <a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.linear_model.Ridge.html#sklearn-linear-model-ridge"><code class="docutils literal notranslate"><span class="pre">sklearn.linear_model.Ridge</span></code></a>:</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">Ridge</span>

<span class="c1"># construct a rigde regression model:</span>
<span class="n">ridge_model</span> <span class="o">=</span> <span class="n">Ridge</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>
<span class="n">ridge_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_z</span><span class="p">,</span> <span class="n">train_y</span><span class="p">)</span>

<span class="n">train_yhat</span> <span class="o">=</span> <span class="n">ridge_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">train_z</span><span class="p">)</span>
<span class="n">val_yhat</span> <span class="o">=</span> <span class="n">ridge_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">val_z</span><span class="p">)</span>

<span class="c1"># evaluate the MSE on the training/validation sets:</span>
<span class="n">train_mse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="n">train_yhat</span> <span class="o">-</span> <span class="n">train_y</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="n">val_mse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="n">val_yhat</span> <span class="o">-</span> <span class="n">val_y</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

<span class="c1"># evaluate the training/validation error:</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;training stddev:&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">train_y</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;training MSE:&#39;</span><span class="p">,</span> <span class="n">train_mse</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;validation MSE:&#39;</span><span class="p">,</span> <span class="n">val_mse</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;validation RMSE/stddev:&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">val_mse</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">train_y</span><span class="p">))</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>training stddev: 0.8648993902607139
training MSE: 0.43916086692415607
validation MSE: 0.4431211081856411
validation RMSE/stddev: 0.769654172578981
</pre></div>
</div>
</div>
</div>
<p>While a model root mean square error (RMSE) that is roughly half of the standard deviation is likely be a statistically significant improvement upon random guessing, it leaves much to be desired. Let’s try a more complex model: <em>Gradient Boosting Regression</em>. Since our dataset is quite large, it may also be more computationally efficient to use the <em>histogram</em> variant, which is implemented in <a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.ensemble.HistGradientBoostingRegressor.html#sklearn-ensemble-histgradientboostingregressor"><code class="docutils literal notranslate"><span class="pre">sklearn.ensemble.HistGradientBoostingRegressor</span></code></a>:</p>
</section>
<section id="gradient-boosting-regression">
<h2>Gradient Boosting Regression<a class="headerlink" href="#gradient-boosting-regression" title="Permalink to this heading">#</a></h2>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">HistGradientBoostingRegressor</span>

<span class="c1"># Construct a histogram gradient boosting model:</span>
<span class="n">hgbr</span> <span class="o">=</span> <span class="n">HistGradientBoostingRegressor</span><span class="p">(</span>
    <span class="n">loss</span><span class="o">=</span><span class="s1">&#39;squared_error&#39;</span><span class="p">,</span>
    <span class="n">learning_rate</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
    <span class="n">max_leaf_nodes</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">hgbr</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_z</span><span class="p">,</span> <span class="n">train_y</span><span class="p">)</span>

<span class="c1"># make predictions on the training/validation sets:</span>
<span class="n">train_yhat</span> <span class="o">=</span> <span class="n">hgbr</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">train_z</span><span class="p">)</span>
<span class="n">val_yhat</span> <span class="o">=</span> <span class="n">hgbr</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">val_z</span><span class="p">)</span>

<span class="c1"># evaluate the MSE on the training/validation sets:</span>
<span class="n">train_mse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="n">train_yhat</span> <span class="o">-</span> <span class="n">train_y</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="n">val_mse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="n">val_yhat</span> <span class="o">-</span> <span class="n">val_y</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

<span class="c1"># print the training/validation error</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;training stddev:&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">train_y</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;training MSE:&#39;</span><span class="p">,</span> <span class="n">train_mse</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;validation MSE:&#39;</span><span class="p">,</span> <span class="n">val_mse</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;validation RMSE/stddev:&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">val_mse</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">train_y</span><span class="p">))</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>training stddev: 0.8648993902607139
training MSE: 0.08587815088682216
validation MSE: 0.1270557773908582
validation RMSE/stddev: 0.4121275221300857
</pre></div>
</div>
</div>
</div>
<p>This is a significant improvement upon the Ridge regression model. Let’s also see how well a support vector regression (SVR) model works for bandgap estimation when we use the radial basis function (RBF) kernel. We will use <a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.svm.SVR.html#sklearn.svm.SVR"><code class="docutils literal notranslate"><span class="pre">sklearn.svm.SVR</span></code></a>. Take note that SVR models may take a few minutes to fit to large datasets:</p>
<section id="rbf-support-vector-regression">
<h3>RBF Support Vector Regression<a class="headerlink" href="#rbf-support-vector-regression" title="Permalink to this heading">#</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.svm</span> <span class="kn">import</span> <span class="n">SVR</span>

<span class="c1"># construct an SVR with an rbf kernel:</span>
<span class="n">svr_model</span> <span class="o">=</span> <span class="n">SVR</span><span class="p">(</span><span class="n">kernel</span><span class="o">=</span><span class="s1">&#39;rbf&#39;</span><span class="p">,</span> <span class="n">C</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">epsilon</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">,</span> <span class="n">cache_size</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>
<span class="n">svr_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_z</span><span class="p">,</span> <span class="n">train_y</span><span class="p">)</span>

<span class="c1"># make predictions on the train/validation/test sets:</span>
<span class="n">train_yhat</span> <span class="o">=</span> <span class="n">svr_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">train_z</span><span class="p">)</span>
<span class="n">val_yhat</span> <span class="o">=</span> <span class="n">svr_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">val_z</span><span class="p">)</span>
<span class="n">test_yhat</span> <span class="o">=</span> <span class="n">svr_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">test_z</span><span class="p">)</span>

<span class="c1"># evaluate the MSE on the train/validation/test sets:</span>
<span class="n">train_mse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="n">train_yhat</span> <span class="o">-</span> <span class="n">train_y</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="n">val_mse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="n">val_yhat</span> <span class="o">-</span> <span class="n">val_y</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="n">test_mse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="n">test_yhat</span> <span class="o">-</span> <span class="n">test_y</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

<span class="c1"># print the training/validation error:</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;# of support vectors:&#39;</span><span class="p">,</span> <span class="n">svr_model</span><span class="o">.</span><span class="n">n_support_</span><span class="p">)</span> 
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;training stddev:&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">train_y</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;training MSE:&#39;</span><span class="p">,</span> <span class="n">train_mse</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;validation MSE:&#39;</span><span class="p">,</span> <span class="n">val_mse</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;validation RMSE/stddev:&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">val_mse</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">train_y</span><span class="p">))</span>

<span class="c1"># print the test error:</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;test MSE:&#39;</span><span class="p">,</span> <span class="n">test_mse</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;test RMSE/stddev: &#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">test_mse</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">train_y</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># of support vectors: [9152]</span>
<span class="n">training</span> <span class="n">stddev</span><span class="p">:</span> <span class="mf">0.8640814456704967</span>
<span class="n">training</span> <span class="n">MSE</span><span class="p">:</span> <span class="mf">0.01842750045837074</span>
<span class="n">validation</span> <span class="n">MSE</span><span class="p">:</span> <span class="mf">0.10748327182498967</span>
<span class="n">validation</span> <span class="n">RMSE</span><span class="o">/</span><span class="n">stddev</span><span class="p">:</span> <span class="mf">0.37941610323604913</span>
<span class="n">test</span> <span class="n">MSE</span><span class="p">:</span> <span class="mf">0.1108143968686793</span>
<span class="n">test</span> <span class="n">RMSE</span><span class="o">/</span><span class="n">stddev</span><span class="p">:</span>  <span class="mf">0.38525067990691425</span>
</pre></div>
</div>
</section>
</section>
<section id="exercises">
<h2>Exercises<a class="headerlink" href="#exercises" title="Permalink to this heading">#</a></h2>
<details class="sd-sphinx-override sd-dropdown sd-card sd-mb-3">
<summary class="sd-summary-title sd-card-header">
Exercise 1: Classifying Direct vs. Indirect Bandgaps<div class="sd-summary-down docutils">
<svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-down" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M5.22 8.72a.75.75 0 000 1.06l6.25 6.25a.75.75 0 001.06 0l6.25-6.25a.75.75 0 00-1.06-1.06L12 14.44 6.28 8.72a.75.75 0 00-1.06 0z"></path></svg></div>
<div class="sd-summary-up docutils">
<svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-up" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M18.78 15.28a.75.75 0 000-1.06l-6.25-6.25a.75.75 0 00-1.06 0l-6.25 6.25a.75.75 0 101.06 1.06L12 9.56l5.72 5.72a.75.75 0 001.06 0z"></path></svg></div>
</summary><div class="sd-summary-content sd-card-body docutils">
<p class="sd-card-text">Let’s apply the same techniques we used to classify metallic versus insulating materials to estimate whether a bandgapped material has a direct or indirect bandgap. We can extract the <span class="math notranslate nohighlight">\(\mathbf{x}\)</span> and <span class="math notranslate nohighlight">\(y\)</span> dataset for this task using the following code:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">direct_gap_x</span> <span class="o">=</span> <span class="n">data_x</span><span class="p">[</span><span class="n">data_y</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
<span class="n">direct_gap_y</span> <span class="o">=</span> <span class="n">data_y</span><span class="p">[(</span><span class="n">data_y</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">),</span><span class="mi">1</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;direct_gap_x shape:&#39;</span><span class="p">,</span> <span class="n">direct_gap_x</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;direct_gap_y shape:&#39;</span><span class="p">,</span> <span class="n">direct_gap_y</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
<p class="sd-card-text">Split this data into training, validation, and test sets. Then, fit a ridge classifier (or another model you think may perform well on this task) to the training set. Visualize the fitted model’s accuracy on a validation set by plotting a confusion matrix. Once you have found a model with acceptable accuracy, evaluate the final accuracy of the model using the test set.</p>
<hr class="docutils" />
<p class="sd-card-text"><em>Hint</em>: Note that you can obtain the accuracy of a classification model in <code class="docutils literal notranslate"><span class="pre">sklearn</span></code> using the <code class="docutils literal notranslate"><span class="pre">model.score(x,y)</span></code> function.</p>
</div>
</details><section id="solutions">
<h3>Solutions<a class="headerlink" href="#solutions" title="Permalink to this heading">#</a></h3>
<section id="exercise-1-classifying-direct-vs-indirect-bandgaps">
<h4>Exercise 1: Classifying Direct vs. Indirect Bandgaps<a class="headerlink" href="#exercise-1-classifying-direct-vs-indirect-bandgaps" title="Permalink to this heading">#</a></h4>
<div class="cell tag_hide-cell docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell content</span>
<span class="expanded">Hide code cell content</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">RidgeClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">confusion_matrix</span><span class="p">,</span> <span class="n">ConfusionMatrixDisplay</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="c1"># get direct bandgap data for materials with nonzero gaps:</span>
<span class="n">direct_gap_x</span> <span class="o">=</span> <span class="n">data_x</span><span class="p">[</span><span class="n">data_y</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
<span class="n">direct_gap_y</span> <span class="o">=</span> <span class="n">data_y</span><span class="p">[(</span><span class="n">data_y</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">),</span><span class="mi">1</span><span class="p">]</span>

<span class="c1"># split data in train/test/validation sets:</span>
<span class="n">direct_subsets_x</span><span class="p">,</span> <span class="n">direct_subsets_y</span> <span class="o">=</span> \
    <span class="n">train_val_test_split</span><span class="p">(</span><span class="n">direct_gap_x</span><span class="p">,</span> <span class="n">direct_gap_y</span><span class="p">)</span>
<span class="n">train_x</span><span class="p">,</span> <span class="n">val_x</span><span class="p">,</span> <span class="n">test_x</span> <span class="o">=</span> <span class="n">direct_subsets_x</span>
<span class="n">train_y</span><span class="p">,</span> <span class="n">val_y</span><span class="p">,</span> <span class="n">test_y</span> <span class="o">=</span> <span class="n">direct_subsets_y</span>

<span class="c1"># normalize data:</span>
<span class="n">scaler</span><span class="p">,</span> <span class="n">train_z</span><span class="p">,</span> <span class="n">val_z</span><span class="p">,</span> <span class="n">test_z</span> <span class="o">=</span> \
    <span class="n">normalize</span><span class="p">(</span><span class="n">train_x</span><span class="p">,</span> <span class="n">val_x</span><span class="p">,</span> <span class="n">test_x</span><span class="p">)</span>

<span class="c1"># fit a ridge classifier to the data:</span>
<span class="n">direct_ridge_model</span> <span class="o">=</span> <span class="n">RidgeClassifier</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">direct_ridge_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_z</span><span class="p">,</span> <span class="n">train_y</span><span class="p">)</span>

<span class="c1"># make predictions on the validation &amp; test sets:</span>
<span class="n">val_yhat</span> <span class="o">=</span> <span class="n">direct_ridge_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">val_z</span><span class="p">)</span>
<span class="n">test_yhat</span> <span class="o">=</span> <span class="n">direct_ridge_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">test_z</span><span class="p">)</span>

<span class="c1"># compute accuracy:</span>
<span class="n">cm</span> <span class="o">=</span> <span class="n">confusion_matrix</span><span class="p">(</span><span class="n">val_y</span><span class="p">,</span> <span class="n">val_yhat</span><span class="p">)</span>

<span class="c1"># display validation set confusion matrix:</span>
<span class="n">disp</span> <span class="o">=</span> <span class="n">ConfusionMatrixDisplay</span><span class="p">(</span><span class="n">confusion_matrix</span><span class="o">=</span><span class="n">cm</span><span class="p">,</span>
                              <span class="n">display_labels</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">classes_</span><span class="p">)</span>
<span class="n">disp</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">([</span><span class="s1">&#39;Direct&#39;</span><span class="p">,</span> <span class="s1">&#39;Indirect&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([</span><span class="s1">&#39;Direct&#39;</span><span class="p">,</span> <span class="s1">&#39;Indirect&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># print validation set accuracy and test set accuracy:</span>
<span class="n">val_acc</span> <span class="o">=</span> <span class="n">direct_ridge_model</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">val_z</span><span class="p">,</span> <span class="n">val_y</span><span class="p">)</span>
<span class="n">test_acc</span> <span class="o">=</span> <span class="n">direct_ridge_model</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">test_z</span><span class="p">,</span> <span class="n">test_y</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;validation set accuracy:&#39;</span><span class="p">,</span> <span class="n">val_acc</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;test set accuracy:&#39;</span><span class="p">,</span> <span class="n">test_acc</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/e8e8596c19c2c8fa4f79d18d46aba9cad408fa4a8a831a878a974c854a4e88cb.png" src="../_images/e8e8596c19c2c8fa4f79d18d46aba9cad408fa4a8a831a878a974c854a4e88cb.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>validation set accuracy: 0.7250523377529658
test set accuracy: 0.7191207257501745
</pre></div>
</div>
</div>
</details>
</div>
</section>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./regression"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="kernel_machines.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Kernel Machines</p>
      </div>
    </a>
    <a class="right-next"
       href="../unsupervised_learning/unsupervised_learning.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Unsupervised Learning</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#bandgap-dataset">Bandgap Dataset</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#loading-the-dataset">Loading the Dataset</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#classifying-metals-and-non-metals">Classifying Metals and Non-Metals</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#estimating-the-bandgap-of-non-metals">Estimating the Bandgap of Non-Metals:</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#ridge-regression-model">Ridge Regression Model:</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#gradient-boosting-regression">Gradient Boosting Regression</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#rbf-support-vector-regression">RBF Support Vector Regression</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercises">Exercises</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#solutions">Solutions</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-1-classifying-direct-vs-indirect-bandgaps">Exercise 1: Classifying Direct vs. Indirect Bandgaps</a></li>
</ul>
</li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Colin Burdine, E. P. Blair, and Nishat-Tasnim Liza
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>